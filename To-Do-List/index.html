<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do-List</title>
    <link rel="stylesheet" href="style.css" type="text/css">
</head>
<body>
    <div class="container">
        <div class="todo-app">
            <h2>To-Do List <img src="images/icon.png" alt="icon"></h2>
            <div class="row">
                <input type="text" id="input-box" placeholder="Add your text">
                <button onclick="addTask()">Add</button>
            </div>
            <ul id="list-container">
                <!--<li class="checked">Task 1</li>
                <li>Task 2</li>
                <li>Task 3</li>-->
            </ul>
        </div>
    </div>
    <script src="script.js"></script>
</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .token-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .token-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button[type="submit"] {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        button[type="submit"]:hover {
            background: #5568d3;
        }

        .response {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .response h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .response pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }

        .error {
            border-left-color: #e53e3e;
        }

        .success {
            border-left-color: #48bb78;
        }

        .file-input {
            padding: 5px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .doc-button {
            border: none;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .doc-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-view {
            background: #0369a1;
            color: white;
        }

        .btn-view:hover {
            background: #075985;
        }

        .btn-download {
            background: #059669;
            color: white;
        }

        .btn-download:hover {
            background: #047857;
        }

        .file-info {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #bae6fd;
        }

        .file-info h4 {
            margin: 0 0 12px 0;
            color: #0369a1;
            font-size: 16px;
        }

        .file-row {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .file-row strong {
            min-width: 120px;
            color: #374151;
        }

        .file-row span {
            flex: 1;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .file-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .file-row strong {
                min-width: auto;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîµ Credit Card API Tester</h1>
        <p class="subtitle">Test all API endpoints for the credit card application system</p>

        <div class="token-section">
            <label>üîë Authorization Token (Set after login/signup)</label>
            <input type="text" id="authToken" placeholder="Your JWT token will appear here after login">
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('signup')">Signup</button>
            <button class="tab" onclick="showSection('login')">Login</button>
            <button class="tab" onclick="showSection('submit')">Submit Application</button>
            <button class="tab" onclick="showSection('myapps')">My Applications</button>
            <button class="tab" onclick="showSection('getapp')">Get Application</button>
            <button class="tab" onclick="showSection('update')">Update Application</button>
            <button class="tab" onclick="showSection('download')">Download Documents</button>
        </div>

        <!-- Signup Section -->
        <div id="signup" class="section active">
            <h2>üìù User Signup</h2>
            <form onsubmit="handleSignup(event)">
                <div class="grid">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" name="lastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit">Create Account</button>
            </form>
            <div id="signupResponse"></div>
        </div>

        <!-- Login Section -->
        <div id="login" class="section">
            <h2>üîê User Login</h2>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit">Login</button>
            </form>
            <div id="loginResponse"></div>
        </div>

        <!-- Submit Application Section -->
        <div id="submit" class="section">
            <h2>üìã Submit Application</h2>
            <form onsubmit="handleSubmit(event)">
                <div class="grid">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required>
                    </div>
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" name="phoneNumber" required>
                    </div>
                    <div class="form-group">
                        <label>Date of Birth *</label>
                        <input type="date" name="dateOfBirth" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Address *</label>
                    <textarea name="address" required></textarea>
                </div>
                <div class="form-group">
                    <label>Card Type *</label>
                    <select name="cardType" required>
                        <option value="">Select Card Type</option>
                        <option value="GOLD">GOLD</option>
                        <option value="PLATINUM">PLATINUM</option>
                        <option value="SILVER">SILVER</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Aadhar PDF *</label>
                    <input type="file" name="aadharPdf" accept=".pdf" required class="file-input">
                </div>
                <div class="form-group">
                    <label>PAN PDF *</label>
                    <input type="file" name="panPdf" accept=".pdf" required class="file-input">
                </div>
                <div class="form-group">
                    <label>Income Proof PDF (Optional)</label>
                    <input type="file" name="incomeProofPdf" accept=".pdf" class="file-input">
                </div>
                <button type="submit">Submit Application</button>
            </form>
            <div id="submitResponse"></div>
        </div>

        <!-- My Applications Section -->
        <div id="myapps" class="section">
            <h2>üìÇ My Applications</h2>
            <button onclick="handleMyApplications()"
                style="background: #667eea; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer;">Get
                My Applications</button>
            <div id="myappsResponse"></div>
        </div>

        <!-- Get Application Section -->
        <div id="getapp" class="section">
            <h2>üîç Get Application by ID</h2>
            <form onsubmit="handleGetApplication(event)">
                <div class="form-group">
                    <label>Application ID *</label>
                    <input type="text" name="appId" required placeholder="e.g., abcd1234-5678-90ef-ghij-klmnopqrstuv">
                </div>
                <button type="submit">Get Application</button>
            </form>
            <div id="getappResponse"></div>
        </div>

        <!-- Update Application Section -->
        <div id="update" class="section">
            <h2>‚úèÔ∏è Update Application</h2>
            <form onsubmit="handleUpdate(event)" id="updateForm">
                <div class="form-group">
                    <label>Application ID *</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="updateAppId" name="appId" required
                            placeholder="e.g., abcd1234-5678-90ef-ghij-klmnopqrstuv" style="flex: 1;">
                        <button type="button" onclick="loadApplicationData()"
                            style="background: #48bb78; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Load
                            Data</button>
                    </div>
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="updateFullName" name="fullName" required autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="updateEmail" name="email" required autocomplete="off">
                    </div>
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" id="updatePhoneNumber" name="phoneNumber" required autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>Date of Birth *</label>
                        <input type="date" id="updateDateOfBirth" name="dateOfBirth" required autocomplete="off">
                    </div>
                </div>
                <div class="form-group">
                    <label>Address *</label>
                    <textarea id="updateAddress" name="address" required autocomplete="off"></textarea>
                </div>
                <div class="form-group">
                    <label>Card Type *</label>
                    <select id="updateCardType" name="cardType" required autocomplete="off">
                        <option value="">Select Card Type</option>
                        <option value="GOLD">GOLD</option>
                        <option value="PLATINUM">PLATINUM</option>
                        <option value="SILVER">SILVER</option>
                    </select>
                </div>
                <div id="currentFilesInfo" style="display: none;"></div>
                <div class="form-group">
                    <label>Aadhar PDF (Optional - only if updating)</label>
                    <input type="file" name="aadharPdf" accept=".pdf" class="file-input">
                </div>
                <div class="form-group">
                    <label>PAN PDF (Optional - only if updating)</label>
                    <input type="file" name="panPdf" accept=".pdf" class="file-input">
                </div>
                <div class="form-group">
                    <label>Income Proof PDF (Optional - only if updating)</label>
                    <input type="file" name="incomeProofPdf" accept=".pdf" class="file-input">
                </div>
                <button type="submit">Update Application</button>
            </form>
            <div id="updateResponse"></div>
        </div>

        <!-- Download Section -->
        <div id="download" class="section">
            <h2>üì• Download Documents</h2>
            <form onsubmit="handleDownload(event)">
                <div class="form-group">
                    <label>Application ID *</label>
                    <input type="text" name="appId" required placeholder="e.g., abcd1234-5678-90ef-ghij-klmnopqrstuv">
                </div>
                <div class="form-group">
                    <label>Document Type *</label>
                    <select name="docType" required>
                        <option value="">Select Document</option>
                        <option value="aadhar">Aadhar PDF</option>
                        <option value="pan">PAN PDF</option>
                        <option value="income-proof">Income Proof PDF</option>
                    </select>
                </div>
                <button type="submit">Download Document</button>
            </form>
            <div id="downloadResponse"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';

        // Store blob URLs for cleanup
        let openPreviewUrls = [];

        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            event.target.classList.add('active');

            // Clean up any preview URLs when switching sections
            cleanupPreviewUrls();
        }

        function cleanupPreviewUrls() {
            openPreviewUrls.forEach(url => {
                try {
                    window.URL.revokeObjectURL(url);
                } catch (e) {
                    console.log('Error cleaning up URL:', e);
                }
            });
            openPreviewUrls = [];
        }

        // Clean up when page is closed/refreshed
        window.addEventListener('beforeunload', cleanupPreviewUrls);

        function displayResponse(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            const className = isError ? 'error' : 'success';
            el.innerHTML = `
                <div class="response ${className}">
                    <h3>${isError ? '‚ùå Error' : '‚úÖ Success'}</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }

        async function handleSignup(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                password: formData.get('password')
            };

            try {
                const response = await fetch(`${API_BASE}/api/auth/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (response.ok) {
                    document.getElementById('authToken').value = result.token;
                    displayResponse('signupResponse', result);
                } else {
                    displayResponse('signupResponse', result, true);
                }
            } catch (error) {
                displayResponse('signupResponse', { error: error.message }, true);
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                email: formData.get('email'),
                password: formData.get('password')
            };

            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (response.ok) {
                    document.getElementById('authToken').value = result.token;
                    displayResponse('loginResponse', result);
                } else {
                    displayResponse('loginResponse', result, true);
                }
            } catch (error) {
                displayResponse('loginResponse', { error: error.message }, true);
            }
        }

        async function handleSubmit(e) {
            e.preventDefault();
            const token = document.getElementById('authToken').value;
            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            const formData = new FormData(e.target);

            try {
                const response = await fetch(`${API_BASE}/api/application/submit`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                const result = await response.json();

                if (response.ok) {
                    displayResponse('submitResponse', result);
                } else {
                    displayResponse('submitResponse', result, true);
                }
            } catch (error) {
                displayResponse('submitResponse', { error: error.message }, true);
            }
        }

        async function handleMyApplications() {
            const token = document.getElementById('authToken').value;
            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/application/my-applications`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();

                if (response.ok) {
                    displayResponse('myappsResponse', result);
                } else {
                    displayResponse('myappsResponse', result, true);
                }
            } catch (error) {
                displayResponse('myappsResponse', { error: error.message }, true);
            }
        }

        async function handleGetApplication(e) {
            e.preventDefault();
            const token = document.getElementById('authToken').value;
            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            const formData = new FormData(e.target);
            const appId = formData.get('appId');

            try {
                const response = await fetch(`${API_BASE}/api/application/${appId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();

                if (response.ok) {
                    displayResponse('getappResponse', result);
                } else {
                    displayResponse('getappResponse', result, true);
                }
            } catch (error) {
                displayResponse('getappResponse', { error: error.message }, true);
            }
        }

        async function loadApplicationData() {
            const appId = document.getElementById('updateAppId').value;
            const token = document.getElementById('authToken').value;

            if (!appId) {
                alert('Please enter an Application ID');
                return;
            }

            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/application/${appId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Populate form fields
                    document.getElementById('updateFullName').value = data.fullName || '';
                    document.getElementById('updateEmail').value = data.email || '';
                    document.getElementById('updatePhoneNumber').value = data.phoneNumber || '';
                    document.getElementById('updateDateOfBirth').value = data.dateOfBirth || '';
                    document.getElementById('updateAddress').value = data.address || '';
                    document.getElementById('updateCardType').value = data.cardType || '';

                    // Show current files with View and Download buttons
                    const filesInfo = document.getElementById('currentFilesInfo');
                    filesInfo.style.display = 'block';
                    filesInfo.className = 'file-info';
                    filesInfo.innerHTML = `
                        <h4>üìé Current Documents</h4>
                        <div class="file-row">
                            <strong>Aadhar:</strong>
                            ${data.aadharFilename
                            ? `<span>${data.aadharFilename}</span>
                                   <button type="button" onclick="previewDocument('${appId}', 'aadhar', '${data.aadharFilename}')" class="doc-button btn-view">üëÅÔ∏è View</button>
                                   <button type="button" onclick="downloadDocument('${appId}', 'aadhar', '${data.aadharFilename}')" class="doc-button btn-download">üì• Download</button>`
                            : '<span style="color: #9ca3af;">Not uploaded</span>'}
                        </div>
                        <div class="file-row">
                            <strong>PAN:</strong>
                            ${data.panFilename
                            ? `<span>${data.panFilename}</span>
                                   <button type="button" onclick="previewDocument('${appId}', 'pan', '${data.panFilename}')" class="doc-button btn-view">üëÅÔ∏è View</button>
                                   <button type="button" onclick="downloadDocument('${appId}', 'pan', '${data.panFilename}')" class="doc-button btn-download">üì• Download</button>`
                            : '<span style="color: #9ca3af;">Not uploaded</span>'}
                        </div>
                        <div class="file-row">
                            <strong>Income Proof:</strong>
                            ${data.incomeProofFilename
                            ? `<span>${data.incomeProofFilename}</span>
                                   <button type="button" onclick="previewDocument('${appId}', 'income-proof', '${data.incomeProofFilename}')" class="doc-button btn-view">üëÅÔ∏è View</button>
                                   <button type="button" onclick="downloadDocument('${appId}', 'income-proof', '${data.incomeProofFilename}')" class="doc-button btn-download">üì• Download</button>`
                            : '<span style="color: #9ca3af;">Not uploaded</span>'}
                        </div>
                    `;

                    alert('‚úÖ Application data loaded successfully!\n\nName: ' + data.fullName + '\nEmail: ' + data.email + '\nPhone: ' + data.phoneNumber);
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'Application not found'));
                }
            } catch (error) {
                console.error('Load error:', error);
                alert('Error loading application: ' + error.message);
            }
        }

        async function handleUpdate(e) {
            e.preventDefault();
            const token = document.getElementById('authToken').value;
            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            const formData = new FormData(e.target);
            const appId = formData.get('appId');
            formData.delete('appId');

            try {
                const response = await fetch(`${API_BASE}/api/application/update/${appId}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                const result = await response.json();

                if (response.ok) {
                    displayResponse('updateResponse', result);
                    // Clean up any open previews after successful update
                    cleanupPreviewUrls();
                } else {
                    displayResponse('updateResponse', result, true);
                }
            } catch (error) {
                displayResponse('updateResponse', { error: error.message }, true);
            }
        }

        async function handleDownload(e) {
            e.preventDefault();
            const token = document.getElementById('authToken').value;
            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            const formData = new FormData(e.target);
            const appId = formData.get('appId');
            const docType = formData.get('docType');

            try {
                const response = await fetch(`${API_BASE}/api/application/${appId}/download/${docType}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${docType}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    displayResponse('downloadResponse', { message: 'Download started successfully!' });
                } else {
                    const result = await response.json();
                    displayResponse('downloadResponse', result, true);
                }
            } catch (error) {
                displayResponse('downloadResponse', { error: error.message }, true);
            }
        }

        // Preview document in new tab (fetches in background, opens in browser PDF viewer)
        async function previewDocument(appId, docType, filename) {
            const token = document.getElementById('authToken').value;
            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            try {
                // Show loading indicator
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚è≥ Loading...';
                button.disabled = true;

                const response = await fetch(`${API_BASE}/api/application/${appId}/download/${docType}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);

                    // Store URL for cleanup
                    openPreviewUrls.push(url);

                    // Open in new tab
                    const newWindow = window.open(url, '_blank');

                    // Clean up URL when the new window is closed
                    if (newWindow) {
                        const checkWindow = setInterval(() => {
                            if (newWindow.closed) {
                                clearInterval(checkWindow);
                                window.URL.revokeObjectURL(url);
                                const index = openPreviewUrls.indexOf(url);
                                if (index > -1) {
                                    openPreviewUrls.splice(index, 1);
                                }
                            }
                        }, 1000);
                    }

                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;
                } else {
                    const result = await response.json();
                    button.innerHTML = originalText;
                    button.disabled = false;
                    alert('Error: ' + (result.error || 'Failed to load document'));
                }
            } catch (error) {
                event.target.innerHTML = 'üëÅÔ∏è View';
                event.target.disabled = false;
                alert('Error previewing document: ' + error.message);
            }
        }

        // Download document with proper authorization
        async function downloadDocument(appId, docType, filename) {
            const token = document.getElementById('authToken').value;
            if (!token) {
                alert('Please login first to get a token');
                return;
            }

            try {
                // Show loading indicator
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚è≥ Downloading...';
                button.disabled = true;

                const response = await fetch(`${API_BASE}/api/application/${appId}/download/${docType}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename || `${docType}.pdf`;
                    document.body.appendChild(a);
                    a.click();

                    // Clean up immediately after download
                    setTimeout(() => {
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    }, 100);

                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;
                } else {
                    const result = await response.json();
                    button.innerHTML = originalText;
                    button.disabled = false;
                    alert('Error: ' + (result.error || 'Failed to download document'));
                }
            } catch (error) {
                event.target.innerHTML = 'üì• Download';
                event.target.disabled = false;
                alert('Error downloading document: ' + error.message);
            }
        }
    </script>
</body>

</html>



